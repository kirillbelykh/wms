{% extends "index.html" %}

{% block content %}
<div class="max-w-4xl mx-auto mt-8">
  <h1 class="text-3xl font-bold mb-6">–Ø—á–µ–π–∫–∏ —Å–∫–ª–∞–¥–∞</h1>

  <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —è—á–µ–π–∫–∏ -->
  <form id="create-cell-form" class="flex flex-wrap gap-2 mb-6">
    <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —è—á–µ–π–∫–∏" required
           class="border rounded px-3 py-2 flex-1 min-w-[150px]">
    <input type="text" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"
           class="border rounded px-3 py-2 flex-1 min-w-[150px]">
    <input type="number" step="0.1" name="capacity" placeholder="–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å"
           class="border rounded px-3 py-2 w-32">
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">–°–æ–∑–¥–∞—Ç—å</button>
  </form>

  <!-- –°–ø–∏—Å–æ–∫ —è—á–µ–µ–∫ -->
  <ul id="cells-list" class="space-y-4">
    {% for cell in cells %}
    <li data-id="{{ cell.id }}" class="flex justify-between items-center p-4 border rounded hover:shadow">
      <div>
        <h2 class="font-semibold text-lg">{{ cell.name or '–ù–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è' }}</h2>
        <p class="text-gray-500">{{ cell.description or '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è' }}</p>
        <p class="text-sm text-gray-400">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: {{ cell.capacity }}</p>
      </div>
      <button onclick="deleteCell({{ cell.id }}, this)" class="text-red-500 hover:text-red-700 ml-4">üóëÔ∏è</button>
    </li>
    {% else %}
    <li class="text-gray-500">–Ø—á–µ–µ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</li>
    {% endfor %}
  </ul>
</div>

<script>
const form = document.getElementById('create-cell-form');
const list = document.getElementById('cells-list');

// –°–æ–∑–¥–∞–Ω–∏–µ —è—á–µ–π–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(form);

  try {
    const response = await fetch('/cells/', {
      method: 'POST',
      body: formData
    });

    if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏');

    const cell = await response.json();
    if (cell.id) {
      const li = document.createElement('li');
      li.dataset.id = cell.id;
      li.className = 'flex justify-between items-center p-4 border rounded hover:shadow';
      li.innerHTML = `
        <div>
          <h2 class="font-semibold text-lg">${cell.name}</h2>
          <p class="text-gray-500">${cell.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
          <p class="text-sm text-gray-400">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ${cell.capacity}</p>
        </div>
        <button onclick="deleteCell(${cell.id}, this)" class="text-red-500 hover:text-red-700 ml-4">üóëÔ∏è</button>
      `;
      list.appendChild(li);
      form.reset();
    }
  } catch (err) {
    console.error(err);
    alert(err.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —è—á–µ–π–∫–∏');
  }
});

// –£–¥–∞–ª–µ–Ω–∏–µ —è—á–µ–π–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
async function deleteCell(cellId, button) {
  if (!confirm('–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —è—á–µ–π–∫—É?')) return;

  try {
    const response = await fetch(`/cells/delete/${cellId}`, { method: 'DELETE' });
    if (response.ok) {
      button.closest('li').remove();
    } else {
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —è—á–µ–π–∫—É');
    }
  } catch (err) {
    console.error(err);
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —è—á–µ–π–∫–∏');
  }
}
</script>
{% endblock %}