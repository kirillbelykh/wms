{% extends "index.html" %}
{% block content %}
<div class="max-w-3xl mx-auto">
  <div class="flex justify-between items-center mb-3">
    <h1 class="text-xl font-bold">Товар: {{ item.name }}</h1>
    <a class="text-red-600" href="/catalogs/items/{{ item.id }}/delete" onclick="return confirm('Удалить?')">Удалить</a>
  </div>

  <form method="post" action="/catalogs/items/{{ item.id }}/update" class="grid gap-3">
    <input name="name" class="border rounded p-2" value="{{ item.name }}" required>
    <input name="description" class="border rounded p-2" value="{{ item.description or '' }}">

    <select name="type_id" class="border rounded p-2">
      <option value="">Тип</option>
      {% for t in types %}
        <option value="{{ t.name }}" {% if item.type == t.name %}selected{% endif %}>{{ t.name }}</option>
      {% endfor %}
    </select>

    <select name="size_id" class="border rounded p-2">
      <option value="">Размер</option>
      {% for s in sizes %}
        <option value="{{ s.name }}" {% if item.size == s.name %}selected{% endif %}>{{ s.name }}</option>
      {% endfor %}
    </select>

    <select name="cell_id" class="border rounded p-2">
      <option value="">Ячейка</option>
      {% for c in cells %}
        <option value="{{ c.id }}" {% if item.cell_id==c.id %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>

    <select name="manufacturer_id" class="border rounded p-2">
      <option value="">Производитель</option>
      {% for m in manufacturers %}
        <option value="{{ m.id }}" {% if item.manufacturer_id==m.id %}selected{% endif %}>{{ m.name }}</option>
      {% endfor %}
    </select>

    <select name="material_id" class="border rounded p-2">
      <option value="">Материал</option>
      {% for m in materials %}
        <option value="{{ m.id }}" {% if item.material_id==m.id %}selected{% endif %}>{{ m.name }}</option>
      {% endfor %}
    </select>

    <select name="unit_id" class="border rounded p-2">
      <option value="">Единица измерения</option>
      {% for u in units %}
        <option value="{{ u.id }}" {% if item.unit_id==u.id %}selected{% endif %}>{{ u.name }}</option>
      {% endfor %}
    </select>

    <div class="flex gap-2">
      <button class="px-4 py-2 rounded bg-green-600 text-white" type="submit">Сохранить</button>
      <a href="/catalogs/items/" class="px-4 py-2 rounded bg-gray-300">Сохранить и закрыть</a>
    </div>
  </form>

  <hr class="my-6">
  <h2 class="font-semibold mb-2">Штрихкод</h2>
  {% if barcode %}
    <div class="p-3 rounded border inline-flex items-center gap-4">
      <div><b>{{ barcode.code }}</b> (кол-во: {{ barcode.quantity }})</div>
      <a class="text-red-600" href="/catalogs/barcodes/{{ barcode.id }}/delete?back=/catalogs/items/{{ item.id }}/" onclick="return confirm('Отвязать и удалить ШК?')">Удалить ШК</a>
    </div>
  {% else %}
    <form method="post" action="/catalogs/barcodes/generate-and-attach" class="flex gap-2 items-end">
      <input type="hidden" name="item_id" value="{{ item.id }}">
      <input name="quantity" type="number" min="1" value="1" class="border rounded p-2" placeholder="Кол-во">
      <button class="px-3 py-2 rounded bg-blue-600 text-white" type="submit">Сгенерировать ШК и привязать</button>
    </form>
  {% endif %}
</div>
{% endblock %}