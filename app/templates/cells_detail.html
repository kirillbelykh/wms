{% extends "index.html" %}

{% block content %}
<div class="max-w-2xl mx-auto mt-8 p-6 border rounded shadow">
  <h1 class="text-3xl font-bold mb-4">{{ cell.name or 'Нет названия' }}</h1>
  
  <p class="text-gray-500 mb-2"><strong>Описание:</strong> {{ cell.description or 'Нет описания' }}</p>
  <p class="text-gray-400 mb-4"><strong>Вместимость:</strong> {{ cell.capacity }}</p>

  <!-- Форма редактирования (пример, можно расширить для PATCH/PUT) -->
  <form id="edit-cell-form" class="flex flex-col gap-3 mb-4">
    <input type="text" name="name" value="{{ cell.name }}" placeholder="Название ячейки"
           class="border rounded px-3 py-2">
    <input type="text" name="description" value="{{ cell.description }}" placeholder="Описание"
           class="border rounded px-3 py-2">
    <input type="number" step="0.1" name="capacity" value="{{ cell.capacity }}" placeholder="Вместимость"
           class="border rounded px-3 py-2">
    <button type="button" onclick="updateCell({{ cell.id }})"
            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
      Сохранить изменения
    </button>
  </form>

  <!-- Кнопка удаления -->
  <button onclick="deleteCell({{ cell.id }})"
          class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
    Удалить ячейку
  </button>
</div>

<script>
async function deleteCell(cellId) {
  if (!confirm('Вы точно хотите удалить эту ячейку?')) return;

  try {
    const response = await fetch(`/cells/delete/${cellId}`, { method: 'DELETE' });
    if (response.ok) {
      alert('Ячейка удалена');
      window.location.href = '/cells';
    } else {
      alert('Не удалось удалить ячейку');
    }
  } catch (err) {
    console.error(err);
    alert('Ошибка при удалении ячейки');
  }
}

async function updateCell(cellId) {
  const form = document.getElementById('edit-cell-form');
  const formData = new FormData(form);

  try {
    const response = await fetch(`/cells/${cellId}`, {
      method: 'PUT',  // или PATCH, если реализуешь PATCH на бэкенде
      body: formData
    });
    if (response.ok) {
      alert('Изменения сохранены');
      window.location.reload();
    } else {
      alert('Не удалось сохранить изменения');
    }
  } catch (err) {
    console.error(err);
    alert('Ошибка при сохранении изменений');
  }
}
</script>
{% endblock %}